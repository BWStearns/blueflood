<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Blueflood by rackerlabs</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Blueflood</h1>
        <h2></h2>
        <a href="https://github.com/rackerlabs/blueflood" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="blueflood---metrics-ingestor-and-rollup-coordinator" class="anchor" href="#blueflood---metrics-ingestor-and-rollup-coordinator"><span class="octicon octicon-link"></span></a>Blueflood - Metrics Ingestor and Rollup Coordinator</h1>

<h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<h1>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h1>

<h2>
<a name="building" class="anchor" href="#building"><span class="octicon octicon-link"></span></a>Building</h2>

<p>The Blueflood distribution gets created as part of <code>ant dist</code>.  If you're
impatient <code>ant jar-bf</code> will create the jar for you without assembling the
dependencies.</p>

<h2>
<a name="running" class="anchor" href="#running"><span class="octicon octicon-link"></span></a>Running</h2>

<p>Several settings are important to set at runtime:</p>

<ul>
<li>
<strong>blueflood.config</strong>: URL pointing to a valid Blueflood configuration file.
An <a href="https://github.com/racker/ele/blob/rollups2/java/conf/bf-dev.conf">annotated config file</a>
is stored in github.</li>
<li>
<strong>log4j.configuration</strong>: Standard log4j configuration URL.</li>
<li>
<strong>com.sun.management.jmxremote.authenticate</strong>: normally false.</li>
<li>
<strong>com.sun.management.jmxremote.ssl</strong>: normally false</li>
<li>
<strong>java.rmi.server.hostname</strong>: specifies the interface that JMX will bind to. This
value defaults to 0.0.0.0.</li>
<li>
<strong>com.sun.management.jmxremote.port</strong>: specifies the port JMX will listen on.
This value defaults to 8080.</li>
</ul><h1>
<a name="tuning" class="anchor" href="#tuning"><span class="octicon octicon-link"></span></a>Tuning</h1>

<p>Blueflood can be tuned at runtime to adjust to changing metric patterns. This
is accomplished by exposing many settings through <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a>.</p>

<h2>
<a name="rollupservice" class="anchor" href="#rollupservice"><span class="octicon octicon-link"></span></a>RollupService</h2>

<ul>
<li>
<strong>Active</strong>: indicates that rollups can be scheduled. There is a poll method 
that always looks for opportunities to schedule rollups, but none will be
scheduled unless this flag is set.  After setting to <strong>false</strong> it may take
some time for pending rollups to drain.</li>
<li>
<strong>InFlightRollupCount</strong>: the number of rollups being executed right now.</li>
<li>
<strong>KeepingServertime</strong>: indicates whether or not the node is actively
updating its clock (set to <strong>false</strong> to control this externally).</li>
<li>
<strong>PollerPeriod</strong>: controls the frequency (in milliseconds) between when
the RollupService looks for rollups that may be scheduled. A shorter period
will result in the map of updates getting scanned more often (tightening
rollup latency somewhat).</li>
<li>
<strong>QueuedRollupCount</strong>: the number of rollups waiting to be executed. This
number is always much lower than the number of rollups that could be
executed.</li>
<li>
<strong>RollupConcurrency</strong>: specifies the size of the threadpool that will
perform rollups.  If QueuedRollupCount seems to be growing, increasing this
value should allow more rollups to be executed.</li>
<li>
<strong>ScheduledSlotCheckCount</strong>: the number of slots that are scheduled and need
to be rolled up. If your server is having a hard time keeping up this
value will be high.  "High" is usually determined as some multiple of
the number of shards this hode is responsible for.</li>
<li>
<strong>SlotCheckConcurrency</strong>: specifies the number of threads that process the
scheduled checks.  Increasing this means that more rollups will be enqueued
and will be available for execution.  If you set this value too high, you 
will enqueue a lot of rollups and consume a lot of memory.</li>
</ul><p>The goal of these tunables is to allow flexible configuration so that a rollup
slave will always have rollups to execute when they are available.</p>

<h3>
<a name="poll-timer" class="anchor" href="#poll-timer"><span class="octicon octicon-link"></span></a>Poll Timer</h3>

<p>Monitors how long it takes for the poll() method to look for schedulable slots.
If poll times are unacceptably high, you should consider adding another
rollup slave.  See also RollupService.PollPeriod.</p>

<h3>
<a name="rejected-slot-checks" class="anchor" href="#rejected-slot-checks"><span class="octicon octicon-link"></span></a>Rejected Slot Checks</h3>

<p>Monitors how often slot checks are rejected because no thread is available to 
service the request.  If this is regularly happening, you may wish to increase
RollupService.PollPeriod.</p>

<h3>
<a name="rollup-execution-timer" class="anchor" href="#rollup-execution-timer"><span class="octicon octicon-link"></span></a>Rollup Execution Timer</h3>

<p>Monitors rollup execution throughput. Keeps track of how many rollups have been
executed, how long it takes and current rates of processing.  This is the best
guage of overall processing throughput.</p>

<h3>
<a name="rollup-wait-histogram" class="anchor" href="#rollup-wait-histogram"><span class="octicon octicon-link"></span></a>Rollup Wait Histogram</h3>

<p>Monitors how long it takes from the time a rollup is enqueued until it is started.
When this value is high, it means that you may be enqueuing more rollups than the
number of threads specified and RollupService.RollupConcurrency can handle.</p>

<h2>
<a name="scribehandler" class="anchor" href="#scribehandler"><span class="octicon octicon-link"></span></a>ScribeHandler</h2>

<p>Monitors:</p>

<ul>
<li>how long scribe Log() calls are taking.</li>
<li>number of thrift messages received on the scribe interface.</li>
<li>how much time is spent deserializing thrift messages.</li>
</ul><h2>
<a name="shardstatepullershardstatepusher" class="anchor" href="#shardstatepullershardstatepusher"><span class="octicon octicon-link"></span></a>ShardStatePuller/ShardStatePusher</h2>

<p>Allows you to set the frequency with which state updates are pushed/fetched
from the database.  Also monitors how long the calls take and if there were
any errors (such as timeouts).  The pusher/puller can also be turned off
through this interface.</p>

<h2>
<a name="ioinstrumentation" class="anchor" href="#ioinstrumentation"><span class="octicon octicon-link"></span></a>io.Instrumentation</h2>

<p>This interface gives visibilty into Cassandra performance from Blueflood's
perspective.</p>

<p>Most exposed meters monitor how long it takes to perform some cassandra
operation.  Keep in mind that the histogram values are biased towards the
most recent 5 minutes of data.</p>

<h3>
<a name="instrumentatedconnectionpoolmonitor" class="anchor" href="#instrumentatedconnectionpoolmonitor"><span class="octicon octicon-link"></span></a>InstrumentatedConnectionPoolMonitor</h3>

<p>Monitors the rates of cassandra read and write errors.  Spikes here 
may indicate systemic problems. Note that a high rate of 'Pool Exhausted'
exceptions with a multi-node Cassandra cluster is to be expected and not
problematic (except when seen alongside operation timeouts).</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/rackerlabs/blueflood/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/rackerlabs/blueflood/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/rackerlabs/blueflood"></a> is maintained by <a href="https://github.com/rackerlabs">rackerlabs</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-42769648-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>